"use strict";var socialLogin=angular.module("socialLogin",[]);socialLogin.provider("social",function(){var e,o,t,n;return{setFbKey:function(t){e=t.appId,o=t.apiVersion;var n,i=document,c=i.getElementsByTagName("script")[0];(n=i.createElement("script")).id="facebook-jssdk",n.async=!0,n.src="//connect.facebook.net/en_US/all.js",n.onload=function(){FB.init({appId:e,status:!0,cookie:!0,xfbml:!0,version:o})},c.parentNode.insertBefore(n,c)},setGoogleKey:function(e){t=e;var o,n=document,i=n.getElementsByTagName("script")[0];(o=n.createElement("script")).async=!0,o.src="//apis.google.com/js/platform.js",o.onload=function(){var o={client_id:e,scope:"email"};gapi.load("auth2",function(){gapi.auth2.init(o)})},i.parentNode.insertBefore(o,i)},setLinkedInKey:function(e){n=e;var o,t=document,i=t.getElementsByTagName("script")[0];(o=t.createElement("script")).async=!1,o.src="//platform.linkedin.com/in.js",o.text=("api_key: "+n).replace('"',""),i.parentNode.insertBefore(o,i)},$get:function(){return{fbKey:e,googleKey:t,linkedInKey:n,fbApiV:o}}}}),socialLogin.factory("socialLoginService",["$window","$rootScope",function(e,o){return{logout:function(){switch(e.localStorage.getItem("_login_provider")){case"google":var t=document.getElementById("gSignout");void 0!==t&&null!=t&&t.remove();var n,i=document,c=i.getElementsByTagName("script")[0];(n=i.createElement("script")).src="https://accounts.google.com/Logout",n.type="text/html",n.id="gSignout",e.localStorage.removeItem("_login_provider"),o.$broadcast("event:social-sign-out-success","success"),c.parentNode.insertBefore(n,c);break;case"linkedIn":IN.User.logout(function(){e.localStorage.removeItem("_login_provider"),o.$broadcast("event:social-sign-out-success","success")},{});break;case"facebook":FB.logout(function(t){e.localStorage.removeItem("_login_provider"),o.$broadcast("event:social-sign-out-success","success")})}},setProvider:function(o){e.localStorage.setItem("_login_provider",o)}}}]),socialLogin.directive("linkedIn",["$rootScope","social","socialLoginService","$window",function(e,o,t,n){return{restrict:"EA",scope:{},link:function(o,n,i){n.on("click",function(){IN.User.authorize(function(){IN.API.Raw("/people/~:(id,first-name,last-name,email-address,picture-url)").result(function(o){t.setProvider("linkedIn");var n={name:o.firstName+" "+o.lastName,email:o.emailAddress,uid:o.id,provider:"linkedIN",imageUrl:o.pictureUrl};e.$broadcast("event:social-sign-in-success",n)})})})}}}]),socialLogin.directive("gLogin",["$rootScope","social","socialLoginService",function(e,o,t){return{restrict:"EA",scope:{},replace:!0,link:function(o,n,i){n.on("click",function(){var n=function(){var e=o.gauth.currentUser.get(),t=e.getBasicProfile(),n=e.getAuthResponse().id_token;return{token:e.getAuthResponse().access_token,idToken:n,name:t.getName(),email:t.getEmail(),uid:t.getId(),provider:"google",imageUrl:t.getImageUrl()}};void 0===o.gauth&&(o.gauth=gapi.auth2.getAuthInstance()),o.gauth.isSignedIn.get()?(t.setProvider("google"),e.$broadcast("event:social-sign-in-success",n())):o.gauth.signIn().then(function(o){t.setProvider("google"),e.$broadcast("event:social-sign-in-success",n())},function(e){console.log(e)})})}}}]),socialLogin.directive("fbLogin",["$rootScope","social","socialLoginService","$q",function(e,o,t,n){return{restrict:"EA",scope:{},replace:!0,link:function(o,i,c){i.on("click",function(){var o=function(){var e=n.defer();return FB.api("/me?fields=name,email,picture",function(o){!o||o.error?e.reject("Error occured while fetching user details."):e.resolve({name:o.name,email:o.email,uid:o.id,provider:"facebook",imageUrl:o.picture.data.url})}),e.promise};FB.getLoginStatus(function(n){"connected"===n.status?o().then(function(o){o.token=n.authResponse.accessToken,t.setProvider("facebook"),e.$broadcast("event:social-sign-in-success",o)}):FB.login(function(n){"connected"===n.status&&o().then(function(o){o.token=n.authResponse.accessToken,t.setProvider("facebook"),e.$broadcast("event:social-sign-in-success",o)})},{scope:"email",auth_type:"rerequest"})})})}}}]);